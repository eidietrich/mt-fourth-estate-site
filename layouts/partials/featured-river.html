{{ $news := .Site.GetPage "/news/_index.md" }}
{{ $featuredStory := where $news.RegularPages ".Params.suppress-featured" "!=" true | first 1 }}
{{ $related := where $news.RegularPages ".Params.special-report" true | complement $featuredStory}}
{{ $features := append $related $featuredStory }}
{{ $pages := $news.RegularPages | complement $featuredStory }}
<section class="section" data-ga-action="Homepage link">
  <div class="container-hp">
    <div class="tile is-ancestor is-vertical">
      <!-- Top story -->
      {{ if gt (len $features) 0 }}
        {{ partial "tile-featured.html" $features }}
      {{ end }}
      <!-- Top 3 stories section -->
      <div class="tile">
        {{ range $page := first 3 $pages }}
          <div class="tile is-parent is-4 has-margin-top-negative">
            <div class="tile is-child">
              {{ partial "tile-stack.html" $page }}
            </div>
          </div>
        {{ end }}
      </div>
      <!-- Newsletter signup section -->
      <div class="tile">
        <div class="tile is-2"></div>
        <div class="tile is-parent is-8">
          <div class="tile is-child" data-ga-form='{"eventCategory": "Newsletter signup", "eventAction": "Homepage inline"}'>
            {{ partial "newsletter-box.html" . }}
          </div>
        </div>
      </div>
      <!-- More top stories section -->
      {{ if gt (len $pages) 3 }}
        <div class="tile">
          <div class="tile is-parent is-top is-8">
            <div class="tile is-child">
              <h2 class="title is-4 is-uppercase has-text-weight-semibold">
                More top stories
              </h2>
              <hr class="is-emphatic-underline has-margin-top-negative">
            </div>
          </div>
        </div>
        {{ range $page := after 3 $pages | first 5 }}
          {{ partial "tile-horiz.html" $page }}
        {{ end }}
      {{ end }}
      <!-- READ MORE Button -->
      {{ if gt (len $pages) 8 }}
        <div class="tile">
          <div class="tile is-parent">
            <div class="tile is-child has-text-centered">
              <a
                href="/news/"
                class="button is-primary is-medium is-uppercase has-text-weight-semibold"
              >Read More</a>
            </div>
          </div>
        </div>
      {{ end }}
      <!-- Promo tiles -->
      <div class="tile">
        {{ partial "tile-promos.html" . }}
      </div>
    </div>
  </div>
</section>
